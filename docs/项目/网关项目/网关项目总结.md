# 架构

该项目是基于Spring Cloud Gateway + Netty + Weblfux实现了一套高性能网关系统，核心架构包括：

1. 路由：动态路由
2. 限流：多层次限流策略
3. 日志：高性能的日志管理
4. 协议适配：Soap -》 Rest
5. 认证鉴权：JWT和OAuth Token
6. 监控：完整的监控链路，
7. 脚本引擎：自定filter逻辑实现





# 网关项目问题？

注意：一定不要给出特别详细的实现，要具备整体架构的思维考虑问题

1. 路由配置表更新过程？

   - 调用更新请求进来
   - 先更新数据库
   - 再更新缓存

2. 缓存？

   1. 路由缓存

   为什么需要分布式缓存？

   多个pod之间公用同一份路由配置，项目重启时，从DB里面load数据，但是当项目运行时需要更新的时，会优先更新数据库的配置，再更新缓存中的配置，防止数据库更新失败导致不一致。

   问题：缓存中更新了，那么其他pod是如何感知到的？

   ​	redis + 发布订阅通知。pod收到消息之后reload配置。

   统一路由配置表更新到redis中，定期

   2. 证书的key缓存

3. QPS 如何配置？

   1. 线上是多个pod部署，那么是配置一样的qps，最后将所有pod的qps加起来就是整个网关的qps


**网关系统中哪些地方用到了缓存**？

1. 证书：因为要加解密，所以需要缓存，每天，定时任务定期检查
2. 路由：路由配置表，需要支持动热加载，因此必须用缓存，缓存最新版本
3. 发布验证：策略缓存（灰度发布，AB验证）
4. 用户信息：JWT解密之后，将用户信息缓存，本地+redis分布式
5. 限流信息：IP，用户，API权重，配置了本地缓存
6. 服务降级：从redis获取core API的降级数据，比如payment is in progress。将请求塞入到队列中，等待统一发送到指定topic补偿。







