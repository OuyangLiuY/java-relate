# 负载均衡

## 1、指标

### 1.1、并发数：

1. **并发的用户数：**有一部分用户使用业务，另外一部分用户 挂机，没有具体操作。

2. **并发连接数：**用户和服务器之间的连接。一部分连接在传输数据，一部分连接 仅仅连接而已。

3. **并发请求数：**请求静态数据，有可能是写操作。

4. **并发线程数：**系统内，并发的线程数目。

### 1.2、吞吐量

定义：单位时间内，能接收和返回得数据请求量

吞吐量高就一定架构能力好吗？

- 看业务
- 看请求得数据

### 1.3、TPS（Transaction Per Second）

每秒进行的事务的数目。（整体定义事务的 请求、操作、返回）。

### 1.4、QPS（Queries Per Second）

每秒查询量



### 1.5、阿姆达尔定律

**加速比：**优化前的响应时间/优化后的响应时间。r。

**增强比例：**某个模块的响应时间/总时间。 <=1，p。

**整体系统的平均响应时间：**t新 = t老时间 * ((1-p)+ p/r)。

**整体系统的加速比：**1/((1-p)+ p/r)。

**目的：**优化 P值大的系统。加大r。

### 1.6、优化

#### 1.6.1、优化并发数

开发工程师，程序中做限流处理

架构优化：减少并发数，防止系统并发数过高

#### 1.6.2、分流

##### 分流：

- 把原来指向一个系统的请求，分散到不同的系统上。
- 将 请求 到达系统前的 各个阶段 ，对请求进行分流。

##### 如何分流

第一步：DNS：域名解析成IP地址，（数据库、map+接口）

- A（Address）记录。ip。

- CName（Canonical Name）记录。域名到域名。

- dns负载均衡：域名添加多个A记录（IP地址）

第二步：CDN：（content delivery network）

将请求发到：距离用户网络拓扑最近的服务器。（拓扑的近 是动态变化的，网络负载，内容可用性，设备工作状况）

##### 分流得优势：

1. 一举两得，减少并发数
2. 让用户访问离他最近的系统（网络拓扑最近），降低网络延时，减少平均响应时间。

##### 分流得缺点：

部署成本 增高，数据的同步 会复杂。（cdn 服务商）。

## 2、CDN（content delivery network）

### 2.1、定义和优点

占用流量大，不经常变。

cdn节点、缓存节点、边缘节点。

源站。

===

减少了系统并发数。

减少了平均响应时间。

减少了网络拥堵。

==

缓存 精通内容：配置规则列表决定哪些数据需要缓存。

动态内容：去源站。

分流。

### 2.2、CDN原理

![](../..\images\architecture\CDN-接入原理.jpg)

源地址:[到底什么是CDN？ - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/52362950)

cdn原理总结：

1. 注册中心。
2. 请求实际服务。

**问题：**CDN解决的是静态数据，那么动态数据怎么办呢？

## 3、动态数据解决方案- 数据直连

通俗的讲，就是将需要请求动态数据的地址，缓存到离自己近的服务器，或者是本地。

解决源站分流问题。

另外一个角度。参与这个功能的角色去分析。

用户。

源站。

拦截。（注册中心=地址映射）

cdn 完了。

静态内容，动态内容，如何进行分流。

好的架构，设计不出来。好的架构一定是演化来的。

追求完美。

前提：对用户有预估。升级。买cdn。

最开始你一个人：硬编码。dic表：写死到代码中。数据库中。